<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parking Database Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .nav-menu {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .nav-button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .nav-button:hover {
            background-color: #45a049;
        }
        .nav-button.active {
            background-color: #2196F3;
        }
        .content-section {
            display: none;
            margin-top: 20px;
        }
        .content-section.active {
            display: block;
        }
        .sql-output {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        input, select {
            padding: 5px;
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .generate-btn {
            background-color: #2196F3;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
        }
        .generate-btn:hover {
            background-color: #1976D2;
        }
        .copy-btn {
            background-color: #ff9800;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        .copy-btn:hover {
            background-color: #e68900;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Parking Database Management System</h1>
        <p style="text-align: center; color: #666;">Static SQL Command Generator for SQLite Database</p>
        <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #856404;">School Server Environment</h3>
            <p style="margin: 10px 0; color: #856404;">This application has been refactored to work within school server restrictions:</p>
            <ul style="color: #856404;">
                <li><strong>No sudo access</strong> - All operations work with user permissions</li>
                <li><strong>Port 80 only</strong> - No custom port configuration needed</li>
                <li><strong>Static HTML/JS only</strong> - PHP no longer supported after course completion</li>
                <li><strong>SQLite3 database</strong> - Migrated from Oracle to SQLite for simplicity</li>
            </ul>
            <p style="margin-bottom: 0; color: #856404;">This interface generates SQL commands that you can run locally with: <code>sqlite3 parking.db</code></p>
        </div>
        
        <div class="nav-menu">
            <button class="nav-button active" onclick="showSection('overview')">Overview</button>
            <button class="nav-button" onclick="showSection('employees')">Employee Management</button>
            <button class="nav-button" onclick="showSection('parking')">Parking Management</button>
            <button class="nav-button" onclick="showSection('reports')">Reports</button>
            <button class="nav-button" onclick="showSection('setup')">Database Setup</button>
        </div>
        
        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <h2>System Overview</h2>
            <p>This Parking Database Management System helps manage employee parking allocations, EV charging bookings, and parking waitlists.</p>
            
            <h3>Database Tables:</h3>
            <ul>
                <li><strong>buildingInfo</strong> - Buildings and their parking capacity</li>
                <li><strong>departmentInfo</strong> - Departments linked to buildings</li>
                <li><strong>employeeInfo</strong> - Employee records with department assignments</li>
                <li><strong>loginInfo</strong> - User authentication and authorization</li>
                <li><strong>parkingInfo</strong> - Parking spot allocations</li>
                <li><strong>evBook</strong> - EV charging station bookings</li>
                <li><strong>parkingWaitList</strong> - Waiting list for parking spots</li>
            </ul>
            
            <h3>Database Access:</h3>
            <div class="sql-output">
# Local SQLite database
Database file: parking.db

# Access via command line:
sqlite3 parking.db

# Execute SQL queries:
sqlite> SELECT * FROM employeeInfo;
sqlite> .tables
sqlite> .quit</div>
        </div>
        
        <!-- Employee Management Section -->
        <div id="employees" class="content-section">
            <h2>Employee Management</h2>
            
            <h3>Add New Employee</h3>
            <div class="form-group">
                <label>Employee ID:</label>
                <input type="number" id="emp-id" placeholder="e.g., 31">
            </div>
            <div class="form-group">
                <label>First Name:</label>
                <input type="text" id="emp-fname" placeholder="e.g., John">
            </div>
            <div class="form-group">
                <label>Last Name:</label>
                <input type="text" id="emp-lname" placeholder="e.g., Doe">
            </div>
            <div class="form-group">
                <label>Status:</label>
                <select id="emp-status">
                    <option value="FT">Full Time (FT)</option>
                    <option value="PT">Part Time (PT)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Department ID:</label>
                <input type="number" id="emp-dept" placeholder="e.g., 1">
            </div>
            <div class="form-group">
                <label>Age:</label>
                <input type="number" id="emp-age" placeholder="e.g., 30">
            </div>
            <button class="generate-btn" onclick="generateEmployeeInsert()">Generate INSERT SQL</button>
            
            <div id="emp-insert-sql" style="display:none;">
                <h4>Generated SQL:</h4>
                <div class="sql-output" id="emp-insert-output"></div>
                <button class="copy-btn" onclick="copyToClipboard('emp-insert-output')">Copy SQL</button>
            </div>
            
            <h3>Other Employee Operations</h3>
            <div class="sql-output">
-- View all employees
SELECT e.*, d.departmentName 
FROM employeeInfo e 
JOIN departmentInfo d ON e.departmentId = d.departmentId 
ORDER BY e.employeeId;

-- Delete an employee (replace [ID] with actual employee ID)
DELETE FROM employeeInfo WHERE employeeId = [ID];

-- Update employee department (replace values)
UPDATE employeeInfo 
SET departmentId = [NEW_DEPT_ID] 
WHERE employeeId = [EMPLOYEE_ID];</div>
        </div>
        
        <!-- Parking Management Section -->
        <div id="parking" class="content-section">
            <h2>Parking Management</h2>
            
            <h3>Assign Parking Spot</h3>
            <div class="form-group">
                <label>Parking Number:</label>
                <input type="number" id="park-num" placeholder="e.g., 7">
            </div>
            <div class="form-group">
                <label>Employee ID:</label>
                <input type="number" id="park-empid" placeholder="e.g., 15">
            </div>
            <button class="generate-btn" onclick="generateParkingAssign()">Generate UPDATE SQL</button>
            
            <div id="park-assign-sql" style="display:none;">
                <h4>Generated SQL:</h4>
                <div class="sql-output" id="park-assign-output"></div>
                <button class="copy-btn" onclick="copyToClipboard('park-assign-output')">Copy SQL</button>
            </div>
            
            <h3>Other Parking Operations</h3>
            <div class="sql-output">
-- View available parking spots
SELECT parkingNum, evCharge, fastCharge 
FROM parkingInfo 
WHERE employeeId IS NULL 
ORDER BY parkingNum;

-- View occupied parking spots
SELECT p.parkingNum, e.firstName, e.lastName, e.employeeId
FROM parkingInfo p
JOIN employeeInfo e ON p.employeeId = e.employeeId
ORDER BY p.parkingNum;

-- Release a parking spot (replace [PARKING_NUM])
UPDATE parkingInfo 
SET employeeId = NULL 
WHERE parkingNum = [PARKING_NUM];

-- Add to waitlist (replace values)
INSERT INTO parkingWaitList (waitListId, employeeId, waitFrom, parkingNum)
VALUES ([ID], [EMP_ID], date('now'), NULL);</div>
        </div>
        
        <!-- Reports Section -->
        <div id="reports" class="content-section">
            <h2>Reports</h2>
            
            <h3>Common Reports</h3>
            <div class="sql-output">
-- 1. Employee Status Report (FT/PT Count)
SELECT employeeStatus, COUNT(*) as count 
FROM employeeInfo 
GROUP BY employeeStatus;

-- 2. Full Time Employees List
SELECT e.employeeId, e.firstName, e.lastName, d.departmentName 
FROM employeeInfo e 
JOIN departmentInfo d ON e.departmentId = d.departmentId 
WHERE e.employeeStatus = 'FT' 
ORDER BY e.lastName;

-- 3. Current Parking Waitlist
SELECT w.waitListId, e.firstName, e.lastName, w.waitFrom
FROM parkingWaitList w
JOIN employeeInfo e ON w.employeeId = e.employeeId
WHERE w.parkingNum IS NULL
ORDER BY w.waitFrom;

-- 4. Youngest Employee
SELECT e.*, d.departmentName 
FROM employeeInfo e
JOIN departmentInfo d ON e.departmentId = d.departmentId
WHERE e.age = (SELECT MIN(age) FROM employeeInfo);

-- 5. Department Parking Statistics
SELECT d.departmentName, 
       COUNT(DISTINCT e.employeeId) as total_employees,
       COUNT(DISTINCT p.parkingNum) as assigned_spots
FROM departmentInfo d
LEFT JOIN employeeInfo e ON d.departmentId = e.departmentId
LEFT JOIN parkingInfo p ON e.employeeId = p.employeeId
GROUP BY d.departmentName
ORDER BY assigned_spots DESC;

-- 6. Parking Utilization Summary
SELECT 
    COUNT(*) as total_spots,
    COUNT(employeeId) as occupied_spots,
    COUNT(*) - COUNT(employeeId) as available_spots,
    ROUND(COUNT(employeeId) * 100.0 / COUNT(*), 2) as utilization_percent
FROM parkingInfo;

-- 7. EV Charging Station Usage
SELECT 
    COUNT(*) as total_bookings,
    COUNT(DISTINCT employeeId) as unique_users,
    COUNT(DISTINCT parkingNum) as stations_used
FROM evBook;</div>
        </div>
        
        <!-- Database Setup Section -->
        <div id="setup" class="content-section">
            <h2>Database Setup</h2>
            <p>Copy and execute these SQL commands to set up the database:</p>
            
            <h3>1. Setup Database</h3>
            <div class="sql-output">
# Run the setup script to create SQLite database:
./setup-school.sh

# This will:
# 1. Create parking.db with all tables
# 2. Insert sample data
# 3. Set proper permissions
# 4. Verify environment

# Manual database creation:
sqlite3 parking.db < src/parkingdata.sql</div>
            
            <h3>2. Verify Installation</h3>
            <div class="sql-output">
-- Check all tables were created
.tables

-- Or with SQL:
SELECT name FROM sqlite_master 
WHERE type='table' 
ORDER BY name;

-- Count records in each table
SELECT 'employeeInfo' as table_name, COUNT(*) as record_count FROM employeeInfo
UNION ALL
SELECT 'buildingInfo', COUNT(*) FROM buildingInfo
UNION ALL
SELECT 'departmentInfo', COUNT(*) FROM departmentInfo
UNION ALL
SELECT 'parkingInfo', COUNT(*) FROM parkingInfo
UNION ALL
SELECT 'parkingWaitList', COUNT(*) FROM parkingWaitList
UNION ALL
SELECT 'evBook', COUNT(*) FROM evBook
UNION ALL
SELECT 'loginInfo', COUNT(*) FROM loginInfo;</div>
        </div>
    </div>
    
    <script>
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.nav-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        function generateEmployeeInsert() {
            const id = document.getElementById('emp-id').value;
            const fname = document.getElementById('emp-fname').value;
            const lname = document.getElementById('emp-lname').value;
            const status = document.getElementById('emp-status').value;
            const dept = document.getElementById('emp-dept').value;
            const age = document.getElementById('emp-age').value;
            
            if (!id || !fname || !lname || !dept || !age) {
                alert('Please fill in all fields');
                return;
            }
            
            const sql = `INSERT INTO employeeInfo (employeeId, firstName, lastName, employeeStatus, departmentId, age)
VALUES (${id}, '${fname}', '${lname}', '${status}', ${dept}, ${age});

-- Don't forget to commit!
COMMIT;`;
            
            document.getElementById('emp-insert-output').textContent = sql;
            document.getElementById('emp-insert-sql').style.display = 'block';
        }
        
        function generateParkingAssign() {
            const parkNum = document.getElementById('park-num').value;
            const empId = document.getElementById('park-empid').value;
            
            if (!parkNum || !empId) {
                alert('Please fill in all fields');
                return;
            }
            
            const sql = `-- First check if parking spot is available
SELECT parkingNum, employeeId 
FROM parkingInfo 
WHERE parkingNum = ${parkNum};

-- If available (employeeId is NULL), assign it
UPDATE parkingInfo 
SET employeeId = ${empId} 
WHERE parkingNum = ${parkNum} 
  AND employeeId IS NULL;

-- Verify the update
SELECT p.parkingNum, e.firstName, e.lastName 
FROM parkingInfo p 
JOIN employeeInfo e ON p.employeeId = e.employeeId 
WHERE p.parkingNum = ${parkNum};

-- Don't forget to commit!
COMMIT;`;
            
            document.getElementById('park-assign-output').textContent = sql;
            document.getElementById('park-assign-sql').style.display = 'block';
        }
        
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('SQL copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('SQL copied to clipboard!');
            });
        }
    </script>
</body>
</html>